{
  "protocolDefinition": "../path/to/protocol-definition",
  "routes": [
    {
      "description": "Inbound Offering query",
      "direction": "INBOUND",
      "match": {
        "interface": "Records",
        "method": "Query",
        "filter.schema": "https://tbd.website/resources/tbdex/Offering"
      },
      "actions": [
        {
          "id": "1",
          "description": "Fetch offering from backend",
          "action": "httpRequest()",
          "params": {
            "method": "GET",
            "endpoint": "https://tbdollars-staging.tbddev.org/tbdex/offers"
          }
        },
        {
          "id": "2",
          "description": "Create the DWN record for the offering",
          "action": "createRecordsWrite()",
          "params": {
            "published": true,
            "data": "#1",
            "dataFormat": "application/json",
            "schema": "https://tbd.website/resources/tbdex/Offering"
          }
        },
        {
          "id": "3",
          "description": "Write the offering record to self",
          "action": "processMessage()",
          "params": {
            "message": "#2",
            "data": "#1"
          }
        },
        {
          "id": "4",
          "description": "Query for the newly written offering record",
          "action": "processMessage()",
          "params": {
            "message": "#inboundDwnRequest.message"
          }
        },
        {
          "id": "5",
          "description": "Reply to client DWN Request",
          "action": "replyToDwnRequest()",
          "params": {
            "reply": "#4"
          }
        }
      ]
    },
    {
      "description": "Inbound RFQ",
      "direction": "INBOUND",
      "match": {
        "interface": "Records",
        "method": "Write",
        "protocol": "#protocolDefinition.protocol",
        "protocolPath": "RFQ",
        "schema": "#protocolDefinition.types.RFQ.schema"
      },
      "actions": [
        {
          "id": "1",
          "description": "PUT fetch the RFQ to the backend",
          "action": "httpRequest()",
          "params": {
            "method": "PUT",
            "endpoint": "https://tbdollars-staging.tbddev.org/tbdex/rfq",
            "body": "#inboundDwnRequest.data"
          }
        },
        {
          "id": "2",
          "description": "Process the inbound DWN Request Message",
          "action": "processMessage()",
          "params": {
            "message": "#inboundDwnRequest.message"
          }
        },
        {
          "id": "3",
          "description": "Reply to client DWN Request",
          "action": "replyToDwnRequest()",
          "params": {
            "reply": "#2"
          }
        }
      ]
    },
    {
      "description": "Outbound Quote",
      "direction": "OUTBOUND",
      "method": "PUT",
      "path": "/quote",
      "actions": [
        {
          "id": "1",
          "description": "Lookup previous RFQ for subsequent processing",
          "action": "queryRecord()",
          "params": {
            "filter": {
              "schema": "#protocolDefinition.types.RFQ.schema"
            },
            "dateStore": "createdAscending"
          }
        },
        {
          "id": "2",
          "description": "Create the DWN record for the quote",
          "action": "createRecordsWrite()",
          "params": {
            "data": "#inboundRequestBody",
            "dataFormat": "application/json",
            "protocol": "#protocolDefinition.protocol",
            "protocolPath": "RFQ/Quote",
            "schema": "#protocolDefinition.types.Quote.schema",
            "recipient": "#inboundRequestBody.to",
            "parentId": "#1.recordId",
            "contextId": "#2.contextId"
          }
        },
        {
          "id": "3",
          "description": "Write the quote record to self",
          "action": "processMessage()",
          "params": {
            "message": "#2",
            "data": "#inboundRequestBody"
          }
        },
        {
          "id": "4",
          "description": "Send the quote to Alice",
          "action": "sendDwnRequest()",
          "params": {
            "to": "#inboundRequestBody.to",
            "message": "#2",
            "data": "#inboundRequestBody"
          }
        }
      ]
    }
  ]
}
